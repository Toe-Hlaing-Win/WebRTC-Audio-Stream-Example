<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>WebRTC Streaming</title>
    <link rel="stylesheet" href="./styles.css">
</head>

<body>

    <h1>SplitSound v0.0.-1</h1>
    <hr><br>

    <form onsubmit="return false;">
        <div><b>Room name: </b></div>
        <input type="text" id="connectRoom" value="test">
        <div id="streamFrom">
        <div><b>Stream from: </b></div>
        <div class="radioButtons">
            <input type="radio" id="fromFile" name="from" value="file" checked>File<br>
            <input type="radio" id="fromDesktop" name="from" value="desktop">Desktop capture (Windows only)
        </div>
        </div>

        <div>
            <button id="connectButton">Connect</button>
        </div>
    </form>

    <h2>Local:</h2>
    <h3>ID: <span id="socketId">disconnected</span></h3>
    <div id="localMedia">
        <audio id="localAudio" autoplay controls muted></audio><br>
        <video id="localVideo" class="localVideo" autoplay controls muted></video>
    </div>

    <h2>Remote Connections:</h2>
    <div id="remoteMedia"></div>

    <script type="text/javascript" src="./node_modules/socket.io-client/dist/socket.io.js"></script>
    <script type="text/javascript" src="./lib.js"></script>
    <script type="text/javascript">
        let socket = new Socket('127.0.0.1', 8080);

        document.getElementById('connectButton').addEventListener('click', async () => {
            // Leave any old rooms
            socket.leaveAllRooms();

            let fromDesktop = document.getElementById('fromDesktop').checked;

            if (fromDesktop) {
                await setupLocalMediaStreams();
            } else {
                await setupLocalMediaStreamsFromFile('./test_file.mp3');
            }

            let room = document.getElementById('connectRoom').value;
            socket.joinRoom(room);
        });

        document.addEventListener('keyup', (e) => {
            if (e.which === 123) {
                require('remote').getCurrentWindow().toggleDevTools();
            } else if (e.which === 116) {
                location.reload();
            }
        });

    </script>
</body>

</html>
